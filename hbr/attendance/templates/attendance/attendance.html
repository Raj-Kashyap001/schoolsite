{% extends 'dashboard/layout.html' %}
{% load static %}

{% block extra_head %}
  <link href="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.19/index.global.min.css" rel="stylesheet" />
{% endblock %}

{% block content %}
  <div class="attendance-container">
    <h1>My Attendance</h1>
    {% if error %}
      <p class="error">{{ error }}</p>
    {% else %}
      <div id="calendar"></div>
    {% endif %}
  </div>
{% endblock %}

{% block inline_js %}
  {{ attendance_events|json_script:'attendance-events' }}
  <script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.19/index.global.min.js"></script>
  <script>
    document.addEventListener('DOMContentLoaded', function () {
      var calendarEl = document.getElementById('calendar')
      var eventsData = JSON.parse(document.getElementById('attendance-events').textContent)
      var role = '{{ role }}'
      var calendar = new FullCalendar.Calendar(calendarEl, {
        initialView: 'dayGridMonth',
        events: eventsData,
        eventClick: function (info) {
          var details = 'Date: ' + info.event.start.toDateString() + '\nStatus: ' + info.event.title + '\nRemarks: ' + (info.event.extendedProps.remarks || 'None')
          if (role === 'Student') {
            details += '\nTeacher: ' + info.event.extendedProps.teacher
          } else if (role === 'Teacher') {
            details += '\nMarked by: ' + info.event.extendedProps.marked_by
          }
          alert(details)
        }
      })
      calendar.render()
    })
  </script>
{% endblock %}
