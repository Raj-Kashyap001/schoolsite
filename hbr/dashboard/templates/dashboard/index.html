{% extends 'dashboard/layout.html' %}
{% load static %}

{% block content %}
  <div class="dashboard-home">
    <!-- Welcome Header -->
    <div class="welcome-section">
      <div class="welcome-content">
        <div class="welcome-greeting">
          <h1>
            Good{% if current_time.hour >= 12 %}
              Afternoon
            {% else %}
              Morning
            {% endif %}, {{ user.first_name }}! ðŸ‘‹
          </h1>
          <p class="role-badge">{{ role }}</p>
        </div>
        <p class="welcome-message">Here's what's happening in your dashboard today.</p>
      </div>
      <div class="current-session">
        <div class="session-card">
          <div class="session-icon">
            <i class="bx bx-calendar"></i>
          </div>
          <div class="session-info">
            <span class="session-label">Current Session</span>
            <span class="session-value">{{ current_session.year|default:'2024-2025' }}</span>
          </div>
        </div>
      </div>
    </div>

    <!-- Statistics Cards -->
    <div class="stats-grid">
      {% for key, value in stats.items %}
        <div class="stat-card">
          <div class="stat-icon">
            <i class="bx bx-{% if key == 'total_students' %}
                
                user-circle

              {% elif key == 'total_teachers' %}
                
                chalkboard-teacher

              {% elif key == 'total_exams' %}
                
                book-open

              {% elif key == 'pending_leaves' %}
                
                calendar-exclamation

              {% elif key == 'active_notices' %}
                
                bell

              {% elif key == 'my_students' %}
                
                users

              {% elif key == 'pending_results' %}
                
                clipboard-list

              {% elif key == 'my_attendance' %}
                
                calendar-check

              {% elif key == 'pending_fees' %}
                
                credit-card

              {% elif key == 'my_leaves' %}
                
                calendar

              {% else %}
                
                chart-line

              {% endif %}">

            </i>
          </div>
          <div class="stat-content">
            <h3>{{ value }}{% if key == 'my_attendance' %}%{% endif %}</h3>
            <p>
              {% if key == 'total_students' %}
                Total Students
              {% elif key == 'total_teachers' %}
                Total Teachers
              {% elif key == 'total_exams' %}
                Total Exams
              {% elif key == 'pending_leaves' %}
                Pending Leaves
              {% elif key == 'active_notices' %}
                Active Notices
              {% elif key == 'my_students' %}
                My Students
              {% elif key == 'pending_results' %}
                Pending Results
              {% elif key == 'my_attendance' %}
                Attendance Rate
              {% elif key == 'pending_fees' %}
                Pending Fees
              {% elif key == 'my_leaves' %}
                My Leaves
              {% else %}
                {{ key|title|cut:'_' }}
              {% endif %}
            </p>
          </div>
        </div>
      {% endfor %}
    </div>

    {% if charts %}
      <div class="charts-section">
        <h2>Analytics & Insights</h2>
        <div class="charts-grid">
          {% if role == 'Admin' %}
            <div class="chart-card">
              <h3>Attendance Trend (Last 7 Days)</h3>
              <canvas id="attendanceChart" width="400" height="200"></canvas>
            </div>
            <div class="chart-card">
              <h3>Exam Performance Distribution</h3>
              <canvas id="performanceChart" width="400" height="200"></canvas>
            </div>
            <div class="chart-card">
              <h3>Leave Status Overview</h3>
              <canvas id="leaveChart" width="400" height="200"></canvas>
            </div>
          {% elif role == 'Teacher' %}
            <div class="chart-card">
              <h3>Class Performance</h3>
              <canvas id="classPerformanceChart" width="400" height="200"></canvas>
            </div>
            <div class="chart-card">
              <h3>Attendance Overview</h3>
              <canvas id="teacherAttendanceChart" width="400" height="200"></canvas>
            </div>
          {% elif role == 'Student' %}
            <div class="chart-card">
              <h3>Performance Trend</h3>
              <canvas id="studentPerformanceChart" width="400" height="200"></canvas>
            </div>
            <div class="chart-card">
              <h3>Weekly Attendance</h3>
              <canvas id="studentAttendanceChart" width="400" height="200"></canvas>
            </div>
          {% endif %}
        </div>
      </div>
    {% endif %}

    <div class="quick-actions-section">
      <h2>Quick Actions</h2>
      <div class="actions-grid">
        {% for action in quick_actions %}
          <a href="{{ action.url }}" class="action-card action-{{ action.color }}">
            <div class="action-icon">
              <i class="bx bx-{{ action.icon }}"></i>
            </div>
            <div class="action-content">
              <h4>{{ action.title }}</h4>
              <span class="action-arrow"><i class="bx bx-chevron-right"></i></span>
            </div>
          </a>
        {% endfor %}
      </div>
    </div>

    {% if recent_activity %}
      <div class="activity-section">
        <h2>Recent Activity</h2>
        <div class="activity-list">
          {% for activity in recent_activity %}
            <div class="activity-item activity-{{ activity.type }}">
              <div class="activity-icon">
                <i class="bx bx-{% if activity.type == 'leave' %}
                    
                    
                    
                    
                    
                    
                    calendar






                  {% elif activity.type == 'result' %}
                    
                    
                    
                    
                    
                    
                    chart






                  {% elif activity.type == 'attendance' %}
                    
                    
                    
                    
                    
                    
                    check-circle






                  {% else %}
                    
                    
                    
                    
                    
                    
                    bell






                  {% endif %}">

                </i>
              </div>
              <div class="activity-content">
                <p>{{ activity.message }}</p>
                <span class="activity-time">{{ activity.time|timesince }} ago</span>
              </div>
              {% if activity.status %}
                <div class="activity-status status-{{ activity.status }}">{{ activity.status|title }}</div>
              {% endif %}
            </div>
          {% endfor %}
        </div>
      </div>
    {% endif %}

    <div class="modules-section">
      <h2>Available Modules</h2>
      <div class="modules-grid">
        {% for section in dashboard_sections %}
          <a href="{{ section.url }}" class="module-card">
            <div class="module-icon">
              <i class="bx bx-{{ section.icon }}"></i>
            </div>
            <h4>{{ section.name }}</h4>
          </a>
        {% endfor %}
      </div>
    </div>
  </div>
{% endblock %}

{% block inline_css %}
  <style>
    :root {
      --color-white: hsl(0 0 99);
      --color-black: hsl(0 0 20);
      --color-primary: hsl(3, 68%, 35%);
      --color-secondary: hsl(190, 45%, 95%);
    }
    
    .dashboard-home {
      padding: 2rem 1rem;
      max-width: 1400px;
      margin: 0 auto;
      display: flex;
      flex-direction: column;
      gap: 2rem;
    }
    
    /* Welcome Section */
    .welcome-section {
      background: linear-gradient(135deg, var(--color-primary) 0%, var(--color-primary) 100%);
      border-radius: 16px;
      padding: 2rem;
      color: var(--color-white);
      display: flex;
      justify-content: space-between;
      align-items: center;
      box-shadow: 0 8px 25px rgba(3, 104, 53, 0.3);
    }
    
    .welcome-content h1 {
      margin: 0 0 0.5rem 0;
      color: var(--color-white);
      font-size: 2.5rem;
      font-weight: 700;
    }
    
    .role-badge {
      background: rgba(255, 255, 255, 0.2);
      padding: 0.5rem 1rem;
      border-radius: 20px;
      font-weight: 600;
      font-size: 0.9rem;
      display: inline-block;
      margin-bottom: 0.5rem;
    }
    
    .welcome-message {
      margin: 0;
      opacity: 0.9;
      font-size: 1.1rem;
    }
    
    .session-card {
      background: rgba(255, 255, 255, 0.1);
      padding: 1rem;
      border-radius: 12px;
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255, 255, 255, 0.2);
    }
    
    .session-icon {
      font-size: 1.5rem;
      margin-bottom: 0.5rem;
      opacity: 0.9;
    }
    
    .session-label {
      display: block;
      font-size: 0.8rem;
      opacity: 0.8;
      margin-bottom: 0.25rem;
    }
    
    .session-value {
      font-weight: 600;
      font-size: 1.1rem;
    }
    
    /* Statistics Cards */
    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 1.5rem;
    }
    
    .stat-card {
      background: var(--color-white);
      border-radius: 12px;
      padding: 1.5rem;
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.08);
      border: 1px solid #e1e5e9;
      display: flex;
      align-items: center;
      gap: 1rem;
      transition: transform 0.3s ease;
    }
    
    .stat-card:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
    }
    
    .stat-icon {
      width: 60px;
      height: 60px;
      background: linear-gradient(135deg, var(--color-primary), var(--color-primary));
      border-radius: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
      color: var(--color-white);
      font-size: 1.5rem;
    }
    
    .stat-content h3 {
      margin: 0 0 0.25rem 0;
      font-size: 2rem;
      font-weight: 700;
      color: var(--color-black);
    }
    
    .stat-content p {
      margin: 0;
      color: #718096;
      font-size: 0.9rem;
      text-transform: capitalize;
    }
    
    /* Charts Section */
    .charts-section {
      background: var(--color-white);
      border-radius: 16px;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
      padding: 2rem;
      border: 1px solid #e1e5e9;
    }
    
    .charts-section h2 {
      color: var(--color-primary);
      margin-bottom: 1.5rem;
      font-size: 1.8rem;
      font-weight: 600;
      border-bottom: 2px solid var(--color-secondary);
      padding-bottom: 0.5rem;
    }
    
    .charts-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
      gap: 2rem;
    }
    
    .chart-card {
      background: #fafbfc;
      border-radius: 12px;
      padding: 1.5rem;
      border: 1px solid #e1e5e9;
    }
    
    .chart-card h3 {
      margin: 0 0 1rem 0;
      color: var(--color-black);
      font-size: 1.2rem;
      font-weight: 600;
    }
    
    /* Quick Actions */
    .quick-actions-section {
      background: var(--color-white);
      border-radius: 16px;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
      padding: 2rem;
      border: 1px solid #e1e5e9;
    }
    
    .quick-actions-section h2 {
      color: var(--color-primary);
      margin-bottom: 1.5rem;
      font-size: 1.8rem;
      font-weight: 600;
      border-bottom: 2px solid var(--color-secondary);
      padding-bottom: 0.5rem;
    }
    
    .actions-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: 1rem;
    }
    
    .action-card {
      background: #fafbfc;
      border-radius: 12px;
      padding: 1.5rem;
      text-decoration: none;
      color: var(--color-black);
      display: flex;
      align-items: center;
      gap: 1rem;
      transition: all 0.3s ease;
      border: 2px solid transparent;
    }
    
    .action-card:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
      border-color: var(--color-primary);
    }
    
    .action-icon {
      width: 50px;
      height: 50px;
      border-radius: 10px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.2rem;
      background: rgba(3, 104, 53, 0.1);
      color: var(--color-primary);
    }
    
    .action-content h4 {
      margin: 0;
      font-size: 1.1rem;
      font-weight: 600;
    }
    
    .action-arrow {
      margin-left: auto;
      color: #a0aec0;
      font-size: 1.2rem;
      transition: color 0.3s ease;
    }
    
    .action-card:hover .action-arrow {
      color: var(--color-primary);
    }
    
    /* Activity Section */
    .activity-section {
      background: var(--color-white);
      border-radius: 16px;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
      padding: 2rem;
      border: 1px solid #e1e5e9;
    }
    
    .activity-section h2 {
      color: var(--color-primary);
      margin-bottom: 1.5rem;
      font-size: 1.8rem;
      font-weight: 600;
      border-bottom: 2px solid var(--color-secondary);
      padding-bottom: 0.5rem;
    }
    
    .activity-list {
      display: flex;
      flex-direction: column;
      gap: 1rem;
    }
    
    .activity-item {
      display: flex;
      align-items: center;
      padding: 1rem 1.5rem;
      border-bottom: 1px solid #f7fafc;
      transition: background-color 0.3s ease;
    }
    
    .activity-item:hover {
      background: #f8fafc;
    }
    
    .activity-item:last-child {
      border-bottom: none;
    }
    
    .activity-icon {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      margin-right: 1rem;
      font-size: 1.1rem;
      background: rgba(3, 104, 53, 0.1);
      color: var(--color-primary);
    }
    
    .activity-content {
      flex: 1;
    }
    
    .activity-content p {
      margin: 0 0 0.25rem 0;
      color: var(--color-black);
      font-weight: 500;
    }
    
    .activity-time {
      color: #718096;
      font-size: 0.8rem;
    }
    
    /* Modules Section */
    .modules-section {
      background: var(--color-white);
      border-radius: 16px;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
      padding: 2rem;
      border: 1px solid #e1e5e9;
    }
    
    .modules-section h2 {
      color: var(--color-primary);
      margin-bottom: 1.5rem;
      font-size: 1.8rem;
      font-weight: 600;
      border-bottom: 2px solid var(--color-secondary);
      padding-bottom: 0.5rem;
    }
    
    .modules-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 1rem;
    }
    
    .module-card {
      background: #fafbfc;
      border-radius: 12px;
      padding: 1.5rem;
      text-decoration: none;
      color: var(--color-black);
      text-align: center;
      transition: all 0.3s ease;
      border: 1px solid #e1e5e9;
    }
    
    .module-card:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
      border-color: var(--color-primary);
    }
    
    .module-icon {
      width: 60px;
      height: 60px;
      background: linear-gradient(135deg, var(--color-primary), var(--color-primary));
      border-radius: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
      color: var(--color-white);
      font-size: 1.5rem;
      margin: 0 auto 1rem;
    }
    
    .module-card h4 {
      margin: 0;
      font-size: 1rem;
      font-weight: 600;
    }
    
    /* Responsive Design */
    @media (max-width: 1024px) {
      .welcome-section {
        padding: 1.5rem;
      }
    
      .stats-grid {
        grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
        gap: 1rem;
      }
    
      .charts-grid {
        grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
      }
    }
    
    @media (max-width: 768px) {
      .dashboard-home {
        padding: 1rem 0.5rem;
        gap: 1.5rem;
        overflow-x: hidden;
        width: 100%;
        box-sizing: border-box;
      }
    
      .welcome-section {
        flex-direction: column;
        text-align: center;
        gap: 1.5rem;
        padding: 1.5rem;
        width: 100%;
        box-sizing: border-box;
      }
    
      .welcome-content h1 {
        font-size: 1.8rem;
        line-height: 1.2;
        word-wrap: break-word;
        overflow-wrap: break-word;
      }
    
      .role-badge {
        font-size: 0.8rem;
        padding: 0.4rem 0.8rem;
        white-space: nowrap;
      }
    
      .welcome-message {
        font-size: 1rem;
        line-height: 1.4;
      }
    
      .session-card {
        padding: 0.8rem;
        min-width: 0;
        flex-shrink: 1;
      }
    
      .session-value {
        font-size: 1rem;
        word-break: break-all;
      }
    
      .stats-grid {
        grid-template-columns: 1fr;
        gap: 1rem;
        width: 100%;
      }
    
      .stat-card {
        padding: 1.2rem;
        flex-direction: row;
        align-items: center;
        width: 100%;
        box-sizing: border-box;
        min-width: 0;
      }
    
      .stat-icon {
        width: 50px;
        height: 50px;
        font-size: 1.2rem;
        flex-shrink: 0;
      }
    
      .stat-content {
        min-width: 0;
        flex: 1;
        overflow: hidden;
      }
    
      .stat-content h3 {
        font-size: 1.8rem;
        word-break: break-all;
      }
    
      .stat-content p {
        font-size: 0.85rem;
        word-break: break-word;
        line-height: 1.3;
      }
    
      .charts-section,
      .quick-actions-section,
      .activity-section,
      .modules-section {
        padding: 1.5rem;
        width: 100%;
        box-sizing: border-box;
        overflow-x: hidden;
      }
    
      .charts-section h2,
      .quick-actions-section h2,
      .activity-section h2,
      .modules-section h2 {
        font-size: 1.5rem;
        word-wrap: break-word;
      }
    
      .charts-grid {
        grid-template-columns: 1fr;
        gap: 1rem;
      }
    
      .chart-card {
        width: 100%;
        box-sizing: border-box;
        overflow-x: hidden;
      }
    
      .actions-grid {
        grid-template-columns: 1fr;
        gap: 0.75rem;
        width: 100%;
      }
    
      .action-card {
        padding: 1.2rem;
        width: 100%;
        box-sizing: border-box;
        overflow-x: hidden;
      }
    
      .action-content {
        min-width: 0;
        flex: 1;
        overflow: hidden;
      }
    
      .action-content h4 {
        font-size: 1rem;
        word-break: break-word;
        line-height: 1.3;
      }
    
      .modules-grid {
        grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
        gap: 0.75rem;
        width: 100%;
      }
    
      .module-card {
        padding: 1.2rem;
        width: 100%;
        box-sizing: border-box;
        overflow-x: hidden;
      }
    
      .module-card h4 {
        font-size: 0.9rem;
        word-break: break-word;
        line-height: 1.3;
      }
    
      .activity-item {
        padding: 1rem;
        flex-direction: column;
        align-items: flex-start;
        gap: 0.75rem;
        width: 100%;
        box-sizing: border-box;
        overflow-x: hidden;
      }
    
      .activity-icon {
        margin-right: 0;
        margin-bottom: 0.5rem;
        flex-shrink: 0;
      }
    
      .activity-content {
        min-width: 0;
        flex: 1;
        overflow: hidden;
      }
    
      .activity-content p {
        font-size: 0.9rem;
        word-break: break-word;
        line-height: 1.4;
      }
    }
    
    @media (max-width: 480px) {
      .dashboard-home {
        padding: 0.75rem 0.25rem;
        gap: 1rem;
      }
    
      .welcome-section {
        padding: 1rem;
        gap: 1rem;
      }
    
      .welcome-content h1 {
        font-size: 1.5rem;
        line-height: 1.1;
      }
    
      .welcome-message {
        font-size: 0.9rem;
        line-height: 1.3;
      }
    
      .stat-card {
        padding: 1rem;
        flex-direction: column;
        text-align: center;
        gap: 0.75rem;
      }
    
      .stat-icon {
        width: 45px;
        height: 45px;
        font-size: 1.1rem;
      }
    
      .stat-content h3 {
        font-size: 1.5rem;
      }
    
      .charts-section,
      .quick-actions-section,
      .activity-section,
      .modules-section {
        padding: 1rem;
      }
    
      .charts-section h2,
      .quick-actions-section h2,
      .activity-section h2,
      .modules-section h2 {
        font-size: 1.3rem;
      }
    
      .modules-grid {
        grid-template-columns: 1fr;
        gap: 0.5rem;
      }
    
      .module-card {
        padding: 1rem;
      }
    
      .action-card {
        padding: 1rem;
        flex-direction: column;
        text-align: center;
        gap: 0.75rem;
      }
    
      .action-icon {
        align-self: center;
      }
    
      .activity-item {
        padding: 0.75rem;
      }
    }
  </style>
{% endblock %}

{% block inline_js %}
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script id="chart-data" type="application/json">
    {
      {
        charts | safe
      }
    }
  </script>
  <script>
    // Chart data from Django
    const role = '{{ role }}'
    const charts = JSON.parse(document.getElementById('chart-data').textContent || '{}')
    
    // Define consistent colors from CSS variables (must match the CSS)
    const PRIMARY_COLOR = '#6a6ee0'
    const SUCCESS_COLOR = '#48bb78'
    const WARNING_COLOR = '#ed8936'
    const DANGER_COLOR = '#e53e3e'
    const INFO_COLOR = '#4299e1'
    const LIGHT_PRIMARY = 'rgba(106, 110, 224, 0.1)'
    const LIGHT_SUCCESS = 'rgba(72, 187, 120, 0.1)'
    const LIGHT_DANGER = 'rgba(229, 62, 62, 0.1)'
    
    // Chart configurations
    if (role === 'Admin') {
      // Attendance Trend Chart
      const attendanceCtx = document.getElementById('attendanceChart')
      if (attendanceCtx && charts.attendance_trend) {
        const attendanceData = charts.attendance_trend
        const labels = attendanceData.map((item) => item.date)
        const presentData = attendanceData.map((item) => item.present)
        const absentData = attendanceData.map((item) => item.absent)
    
        new Chart(attendanceCtx, {
          type: 'line',
          data: {
            labels: labels,
            datasets: [
              {
                label: 'Present',
                data: presentData,
                borderColor: SUCCESS_COLOR,
                backgroundColor: LIGHT_SUCCESS,
                tension: 0.4,
                fill: true
              },
              {
                label: 'Absent',
                data: absentData,
                borderColor: DANGER_COLOR,
                backgroundColor: LIGHT_DANGER,
                tension: 0.4,
                fill: true
              }
            ]
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
              legend: {
                position: 'top'
              }
            },
            scales: {
              y: {
                beginAtZero: true
              }
            }
          }
        })
      }
    
      // Performance Distribution Chart
      const performanceCtx = document.getElementById('performanceChart')
      if (performanceCtx && charts.exam_performance) {
        new Chart(performanceCtx, {
          type: 'doughnut',
          data: {
            labels: ['A Grade', 'B Grade', 'C Grade', 'D Grade', 'F Grade'],
            datasets: [
              {
                data: Object.values(charts.exam_performance),
                backgroundColor: [SUCCESS_COLOR, INFO_COLOR, WARNING_COLOR, '#ecc94b', DANGER_COLOR],
                borderWidth: 1,
                hoverOffset: 4
              }
            ]
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
              legend: {
                position: 'bottom'
              }
            }
          }
        })
      }
    
      // Leave Status Chart
      const leaveCtx = document.getElementById('leaveChart')
      if (leaveCtx && charts.leave_status) {
        new Chart(leaveCtx, {
          type: 'bar',
          data: {
            labels: ['Approved', 'Pending', 'Rejected'],
            datasets: [
              {
                data: Object.values(charts.leave_status),
                backgroundColor: [SUCCESS_COLOR, WARNING_COLOR, DANGER_COLOR],
                borderRadius: 4
              }
            ]
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
              legend: {
                display: false
              }
            },
            scales: {
              y: {
                beginAtZero: true
              }
            }
          }
        })
      }
    } else if (role === 'Teacher') {
      // Class Performance Chart
      const classPerformanceCtx = document.getElementById('classPerformanceChart')
      if (classPerformanceCtx && charts.class_performance) {
        const performanceData = charts.class_performance
        const labels = performanceData.map((item) => item.exam)
        const data = performanceData.map((item) => item.average)
    
        new Chart(classPerformanceCtx, {
          type: 'bar',
          data: {
            labels: labels,
            datasets: [
              {
                label: 'Average Marks',
                data: data,
                backgroundColor: PRIMARY_COLOR,
                borderColor: PRIMARY_COLOR,
                borderWidth: 1,
                borderRadius: 4
              }
            ]
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
              legend: {
                display: false
              }
            },
            scales: {
              y: {
                beginAtZero: true,
                max: 100
              }
            }
          }
        })
      }
    
      // Teacher Attendance Chart
      const teacherAttendanceCtx = document.getElementById('teacherAttendanceChart')
      if (teacherAttendanceCtx && charts.attendance_overview) {
        const attendanceData = charts.attendance_overview
        const labels = attendanceData.map((item) => item.date)
        const data = attendanceData.map((item) => item.marked)
    
        new Chart(teacherAttendanceCtx, {
          type: 'line',
          data: {
            labels: labels,
            datasets: [
              {
                label: 'Attendance Marked',
                data: data,
                borderColor: PRIMARY_COLOR,
                backgroundColor: LIGHT_PRIMARY,
                tension: 0.4,
                fill: true
              }
            ]
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
              legend: {
                display: false
              }
            },
            scales: {
              y: {
                beginAtZero: true
              }
            }
          }
        })
      }
    } else if (role === 'Student') {
      // Student Performance Chart
      const studentPerformanceCtx = document.getElementById('studentPerformanceChart')
      if (studentPerformanceCtx && charts.performance_trend) {
        const performanceData = charts.performance_trend
        const labels = performanceData.map((item) => item.exam)
        const data = performanceData.map((item) => item.marks)
    
        new Chart(studentPerformanceCtx, {
          type: 'line',
          data: {
            labels: labels,
            datasets: [
              {
                label: 'Marks',
                data: data,
                borderColor: PRIMARY_COLOR,
                backgroundColor: LIGHT_PRIMARY,
                tension: 0.4,
                pointBackgroundColor: PRIMARY_COLOR,
                pointBorderColor: '#fff',
                pointBorderWidth: 2,
                fill: false
              }
            ]
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
              legend: {
                display: false
              }
            },
            scales: {
              y: {
                beginAtZero: true,
                max: 100
              }
            }
          }
        })
      }
    
      // Student Attendance Chart
      const studentAttendanceCtx = document.getElementById('studentAttendanceChart')
      if (studentAttendanceCtx && charts.attendance_chart) {
        const attendanceData = charts.attendance_chart
        const labels = attendanceData.map((item) => item.date)
        const data = attendanceData.map((item) => (item.status === 'present' ? 1 : 0))
    
        new Chart(studentAttendanceCtx, {
          type: 'bar',
          data: {
            labels: labels,
            datasets: [
              {
                label: 'Attendance',
                data: data,
                backgroundColor: function (context) {
                  const value = context.parsed.y
                  return value === 1 ? SUCCESS_COLOR : DANGER_COLOR
                },
                borderRadius: 4
              }
            ]
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
              legend: {
                display: false
              }
            },
            scales: {
              y: {
                beginAtZero: true,
                max: 1,
                ticks: {
                  stepSize: 1,
                  callback: function (value) {
                    return value === 1 ? 'Present' : value === 0 ? 'Absent' : ''
                  }
                }
              },
              x: {
                grid: {
                  display: false
                }
              }
            }
          }
        })
      }
    }
  </script>
{% endblock %}
