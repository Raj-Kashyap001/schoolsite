{% extends 'dashboard/layout.html' %}

{% block content %}
  <div class="manage-notifications-container">
    <div class="page-header">
      <h1>Teacher Notifications - {{ classroom }}</h1>
      <a href="{% url 'students:class_management' %}" class="btn btn-outline"><i class="bx bx-arrow-back"></i> Back to Class Management</a>
    </div>

    <div class="notifications-management">
      <!-- Create Notification Section -->
      <div class="create-notification-section">
        <h2>Create New Notification</h2>
        <form method="post" class="notification-form">
          {% csrf_token %}
          <input type="hidden" name="create_notification" value="1" />

          <div class="form-group">
            <label for="teacher_id">Teacher:</label>
            <select name="teacher_id" id="teacher_id" required>
              <option value="">Select Teacher</option>
              {% for teacher in teachers %}
                <option value="{{ teacher.id }}">{{ teacher.user.get_full_name }} ({{ teacher.subject }})</option>
              {% endfor %}
            </select>
          </div>

          <div class="form-group">
            <label for="title">Title:</label>
            <input type="text" name="title" id="title" placeholder="Notification title" required />
          </div>

          <div class="form-group">
            <label for="message">Message:</label>
            <textarea name="message" id="message" rows="4" placeholder="Notification message" required></textarea>
          </div>

          <div class="form-group">
            <label for="priority">Priority:</label>
            <select name="priority" id="priority">
              {% for priority_code, priority_name in priorities %}
                <option value="{{ priority_code }}">{{ priority_name }}</option>
              {% endfor %}
            </select>
          </div>

          <button type="submit" class="btn btn-primary"><i class="bx bx-send"></i> Send Notification</button>
        </form>
      </div>

      <!-- Existing Notifications Section -->
      <div class="existing-notifications-section">
        <h2>Recent Notifications</h2>

        {% if notifications %}
          <div class="notifications-list">
            {% for notification in notifications %}
              <div class="notification-item priority-{{ notification.priority|lower }}">
                <div class="notification-header">
                  <div class="notification-meta">
                    <span class="teacher-name">{{ notification.teacher.user.get_full_name }}</span>
                    <span class="priority-badge priority-{{ notification.priority|lower }}">{{ notification.get_priority_display }}</span>
                    <span class="notification-date">{{ notification.created_at|date:'M d, Y H:i' }}</span>
                  </div>
                  <form method="post" class="delete-form">
                    {% csrf_token %}
                    <input type="hidden" name="delete_notification" value="{{ notification.id }}" />
                    <button type="submit" class="btn btn-danger btn-sm" onclick="return confirm('Are you sure you want to delete this notification?')"><i class="bx bx-trash"></i> Delete</button>
                  </form>
                </div>

                <div class="notification-content">
                  <h4>{{ notification.title }}</h4>
                  <p>{{ notification.message }}</p>
                </div>

                <div class="notification-status">
                  {% if notification.is_read %}
                    <span class="status-read"><i class="bx bx-check"></i> Read</span>
                  {% else %}
                    <span class="status-unread"><i class="bx bx-time"></i> Unread</span>
                  {% endif %}
                </div>
              </div>
            {% endfor %}
          </div>
        {% else %}
          <div class="no-notifications">
            <p>No notifications have been sent for this class yet.</p>
          </div>
        {% endif %}
      </div>
    </div>
  </div>
{% endblock %}
