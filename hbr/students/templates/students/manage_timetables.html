{% extends 'dashboard/layout.html' %}

{% block content %}
  <div class="manage-timetables-container">
    <div class="page-header">
      <h1>Manage Timetables - {{ classroom }}</h1>
      <a href="{% url 'students:class_management' %}" class="btn btn-outline"><i class="bx bx-arrow-back"></i> Back to Class Management</a>
    </div>

    <div class="timetables-management">
      <!-- Daily Timetables Section -->
      <div class="timetable-section">
        <h2>Daily Timetables</h2>

        <!-- Upload Daily Timetable -->
        <div class="upload-section">
          <h3>Upload Daily Timetable</h3>
          <form method="post" enctype="multipart/form-data" class="upload-form">
            {% csrf_token %}
            <div class="form-group">
              <label for="day_of_week">Day of Week:</label>
              <select name="day_of_week" id="day_of_week" required>
                <option value="">Select Day</option>
                {% for day_code, day_name in days_of_week %}
                  <option value="{{ day_code }}">{{ day_name }}</option>
                {% endfor %}
              </select>
            </div>
            <div class="form-group">
              <label for="daily_timetable">Timetable File:</label>
              <input type="file" name="daily_timetable" id="daily_timetable" accept=".pdf,.doc,.docx,.jpg,.png" required />
            </div>
            <button type="submit" class="btn btn-primary"><i class="bx bx-upload"></i> Upload Daily Timetable</button>
          </form>
        </div>

        <!-- Existing Daily Timetables -->
        <div class="existing-timetables">
          <h3>Current Daily Timetables</h3>
          {% if daily_timetables %}
            <div class="timetables-list">
              {% for timetable in daily_timetables %}
                <div class="timetable-item">
                  <div class="timetable-info">
                    <span class="day">{{ timetable.get_day_of_week_display }}</span>
                    <span class="uploaded-date">Uploaded: {{ timetable.uploaded_at|date:'M d, Y' }}</span>
                    {% if timetable.timetable_file %}
                      <a href="{{ timetable.timetable_file.url }}" target="_blank" class="btn btn-sm"><i class="bx bx-show"></i> View</a>
                    {% endif %}
                  </div>
                  <form method="post" class="delete-form">
                    {% csrf_token %}
                    <input type="hidden" name="delete_daily" value="{{ timetable.id }}" />
                    <button type="submit" class="btn btn-danger btn-sm" onclick="return confirm('Are you sure you want to delete this timetable?')"><i class="bx bx-trash"></i> Delete</button>
                  </form>
                </div>
              {% endfor %}
            </div>
          {% else %}
            <p class="no-timetables">No daily timetables uploaded yet.</p>
          {% endif %}
        </div>
      </div>

      <!-- Exam Timetables Section -->
      <div class="timetable-section">
        <h2>Exam Timetables</h2>

        <!-- Upload Exam Timetable -->
        <div class="upload-section">
          <h3>Upload Exam Timetable</h3>
          <form method="post" enctype="multipart/form-data" class="upload-form">
            {% csrf_token %}
            <div class="form-group">
              <label for="exam_title">Exam Title:</label>
              <input type="text" name="exam_title" id="exam_title" placeholder="e.g., Mid-term Exam 2025" required />
            </div>
            <div class="form-group">
              <label for="exam_timetable">Timetable File:</label>
              <input type="file" name="exam_timetable" id="exam_timetable" accept=".pdf,.doc,.docx,.jpg,.png" required />
            </div>
            <button type="submit" class="btn btn-primary"><i class="bx bx-upload"></i> Upload Exam Timetable</button>
          </form>
        </div>

        <!-- Existing Exam Timetables -->
        <div class="existing-timetables">
          <h3>Current Exam Timetables</h3>
          {% if exam_timetables %}
            <div class="timetables-list">
              {% for timetable in exam_timetables %}
                <div class="timetable-item">
                  <div class="timetable-info">
                    <span class="title">{{ timetable.title }}</span>
                    <span class="uploaded-date">Uploaded: {{ timetable.uploaded_at|date:'M d, Y' }}</span>
                    {% if timetable.timetable_file %}
                      <a href="{{ timetable.timetable_file.url }}" target="_blank" class="btn btn-sm"><i class="bx bx-show"></i> View</a>
                    {% endif %}
                  </div>
                  <form method="post" class="delete-form">
                    {% csrf_token %}
                    <input type="hidden" name="delete_exam" value="{{ timetable.id }}" />
                    <button type="submit" class="btn btn-danger btn-sm" onclick="return confirm('Are you sure you want to delete this timetable?')"><i class="bx bx-trash"></i> Delete</button>
                  </form>
                </div>
              {% endfor %}
            </div>
          {% else %}
            <p class="no-timetables">No exam timetables uploaded yet.</p>
          {% endif %}
        </div>
      </div>
    </div>
  </div>
{% endblock %}
